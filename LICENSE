version: '3.9'

services:
    spark-master:
        image: hackathron/spark-master:3.3.0-hadoop3.3
        container_name: spark-master
        ports:
            - "8080:8080"
            - "7077:7077"
            - "10002:10001"
        volumes:
            - ./docker-mount/spark/hive-site.xml:/spark/conf/hive-site.xml
            - ./docker-mount/spark/master.sh:/master.sh
            - ./driver/hadoop-aws-3.3.2.jar:/spark/jars/hadoop-aws-3.3.2.jar
        environment:
            - INIT_DAEMON_STEP=setup_spark
    spark-worker-1:
        image: bde2020/spark-worker:3.3.0-hadoop3.3
        container_name: spark-worker-1
        depends_on:
            - spark-master
        ports:
            - "8081:8081"
        environment:
            - "SPARK_MASTER=spark://spark-master:7077"
        volumes:
            - ./docker-mount/spark/hive-site.xml:/spark/conf/hive-site.xml
            - ./driver/hadoop-aws-3.3.2.jar:/spark/jars/hadoop-aws-3.3.2.jar
    spark-worker-2:
        image: bde2020/spark-worker:3.3.0-hadoop3.3
        container_name: spark-worker-2
        depends_on:
            - spark-master
        ports:
            - "8082:8081"
        environment:
            - "SPARK_MASTER=spark://spark-master:7077"
        volumes:
            - ./docker-mount/spark/hive-site.xml:/spark/conf/hive-site.xml
            - ./driver/hadoop-aws-3.3.2.jar:/spark/jars/hadoop-aws-3.3.2.jar
    spark-history-server:
        image: bde2020/spark-history-server:3.3.0-hadoop3.3
        container_name: spark-history-server
        depends_on:
            - spark-master
        ports:
            - "18081:18081"
        volumes:
            - ./docker-mount/spark/hive-site.xml:/spark/conf/hive-site.xml
            - ./driver/hadoop-aws-3.3.2.jar:/spark/jars/hadoop-aws-3.3.2.jar

networks:
    ailineage_network:
        driver: bridge

